***

## \# 编码原则
- 简明易懂；代码是给人看的，不仅仅只是给机器执行的
- 编码规范，命名风格统一
- 适当明确的代码注释

## \# 工具配置
- [PhpStorm配置指南](https://github.com/baixing/haojing/wiki/PhpStorm-配置指南)

## \# 适用原则
- 所有新代码、新类、新需求开发采用本套编码规范
- 对于老代码、老类上的小范围修改延续该类的原有风格以保持局部的代码格式一致性，后续重构逐步演进

## \# 编码规范概要：

### 特别注意点
- 缩进用tab，不用空格
- 短语句也需要用{}包括起来，比如即使if后只有一行语句，{位于if同行，}位于代码语句下一行
- 每个类文件需要有owner和类功能说明
- 类变量、属性、函数命名采用驼峰，如camelNaming()
- 类名统一采用首字母大写不加下划线，如VipController
- 每个类单独一个文件

### 代码示例
```<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

/**
 * 这个类是用于做代码示例的
 * 
 * @author 南智敏<nanzhimin@baixing.com>
 */
abstract class ClassName extends ParentClass implements \ArrayAccess, \Countable {
    const CONST_NAME = 'nothing';

    protected static $foo;

    abstract protected function zim();

    final public static function bar() {
        // method body
    }

    /**
     * 这个是用来做注释描述的函数
     * @param int $arg1 参数1
     * @param bool $arg2 参数2
     * @param array $arg3 参数3
     */
    public function fooBarBaz($arg1, &$arg2, $arg3 = []) {
        // method body
    }
}
```

## \# 编码规范细节：

### PHP文件
- 文件编码类型统一用utf-8编码（不带BOM）
- 文件末尾留一个空行
- 仅含PHP代码的文件最后的?>标签忽略

### 代码行
- 行宽：120 字符，最好不超过80字符
- Unix 风格的换行: LF
- 代码行结尾不带空格
- 可以增加空行来增加代码可读性或区分代码块
- 每行不超过一条语句

### 缩进
- 代码缩进全部用tab（与PSR-2不一致，特别注意）

### 关键词
- PHP关键词采用全小写

### 代码注释
- 注释规范遵循[PHP Doc规范](https://www.phpdoc.org/docs/latest/references/phpdoc/index.html)
- 所有类注释必须有类描述和owner邮箱
- 所有核心关键方法、函数注释必须包含描述、参数说明、返回值说明，必须时可以有具体函数逻辑
- 代码中的复杂功能逻辑需要有明确的描述性注释

### 完整类名与自动加载（PSR-4）

这里的类指所有类、接口、trait和其他相似的结构

\<NamespaceName>(\<SubNamespaceNames>)*\<ClassName>
- 完整类名称必须一个顶级命名空间为供应商命名空间
- 完整类名称可以有一个或多个子命名空间
- 完整类名称末尾必须有一个类名
- _不会被作为完整类名称的分隔符 
- 所有类目是字母大小写敏感的
- 自动加载文件时，完整类名称的前面命名空间对应文件夹名称，最后的类名加.php对应文件名
- 自动加载实现不能抛出异常，不能抛出任何级别的错误，不能返回值

### 命名空间的使用
- 当存在时，use命名空间必须在namespace定义之后再空一行空行
- 当存在时，所有use命名空间必须在namespace定义之后
- 每行声明必须使用一个use关键词
- use代码块之后必须有一行空行

```
<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

// ... additional PHP code ...
```

### 类、属性、方法

这里的类指所有类、接口、trait

- extends和implements关键字必须与类名字在一行
- {放在类名声明末尾同一行，}必须在代码块后面一行

```<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements \ArrayAccess, \Countable {
    // constants, properties, methods
}
```

- implements列表可以分拆成多行，每个一行；这么做时，第一项必须在下一行，并且之后每行只能有一个接口

```<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements
    \ArrayAccess,
    \Countable,
    \Serializable {
    // constants, properties, methods
}
```

### 常量
- 类常量必须使用全部大写，单词间使用_分隔
```<?php
namespace Vendor\Package;

class ClassName {
    const CONST_NAME = 'nothing';
}
```

### 属性

- 所有属性必须有可见性声明
- var关键字不能用于声明属性
- 每个语句不能定义多余一个属性
- 属性名称不能使用前导_来指示protected或private的可见性

```<?php
namespace Vendor\Package;

class ClassName {
    public $foo = null;
}
```

### 方法

- 可见性必须被声明在所有方法上
- 方法名称不能使用前导_来指示protected或private的可见性
- 方法名之后不能有空格。{在)同一行，}必须在代码块后面一行。(后不能有空格，)前不能有空格

```<?php
namespace Vendor\Package;

class ClassName {
    public function fooBarBaz($arg1, &$arg2, $arg3 = []) {
        // method body
    }
}
```

### 方法参数

- 在参数列表中，每个逗号前不能有空格，逗号后必须有一个空格
- 带默认值的参数必须在参数列表的最后
- 参数列表可以被分成多行，每个子序列带一个缩进；当这么做时，列表的第一项必须在下一行，并且之后每行一个参数
- 当参数列表被分成多行时，)必须放置在{的一行，且中间有一个空格

```<?php
namespace Vendor\Package;

class ClassName {
    public function aVeryLongMethodName(
        ClassTypeHint $arg1,
        &$arg2,
        array $arg3 = []
    ) {
        // method body
    }
}
```

abstract, final和static
- 当存在时，abstract和final声明必须在可见性声明之前
- 当存在时，static声明必须在可见性声明之后

```<?php
namespace Vendor\Package;

abstract class ClassName {
    protected static $foo;

    abstract protected function zim();

    final public static function bar() {
        // method body
    }
}
```

### 方法与函数调用

- 方法与函数调用时，方法或函数名与(之间不能有空格，(之后不能有空格，)之前不能有空格。在参数列表中，每个逗号前不能有空格，逗号后必须有一个空格

```<?php
bar();
$foo->bar($arg1);
Foo::bar($arg2, $arg3);
```

- 参数列表可以被分成多行，每个子序列带一个缩进；当这么做时，列表的第一项必须在下一行，并且之后每行一个参数

```<?php
$foo->bar(
    $longArgument,
    $longerArgument,
    $muchLongerArgument
);
```

### 控制结构的代码基本规范

- 控制关键字后必须有一个空格
- (后不能有空格，)前不能有空格
- )和{之间必须有一个空格
- 结构体必须有一个缩进
- }必须在代码块下面一行

### if, elseif, else

- elseif代替else if，使得看起来是一个关键字
- 其他格式如下

```<?php
if ($expr1) {
    // if body
} elseif ($expr2) {
    // elseif body
} else {
    // else body;
}
```

### swith, case
```<?php
switch ($expr) {
    case 0:
        echo 'First case, with a break';
        break;
    case 1:
        echo 'Second case, which falls through';
        // no break
    case 2:
    case 3:
    case 4:
        echo 'Third case, return instead of break';
        return;
    default:
        echo 'Default case';
        break;
}
```

### while, do while
```<?php
while ($expr) {
    // structure body
}

do {
    // structure body;
} while ($expr);
```

### for
```<?php
for ($i = 0; $i < 10; $i++) {
    // for body
}
```

### foreach
```<?php
foreach ($iterable as $key => $value) {
    // foreach body
}
```

### try, catch
```<?php
try {
    // try body
} catch (FirstExceptionType $e) {
    // catch body
} catch (OtherExceptionType $e) {
    // catch body
}
```

### 闭包
- 闭包的声明中在function关键词后必须有一个空格，在use关键词前后都必须有一个空格
- {必须与声明在一行，}必须在代码块的下一行
- 其他空格逗号规则与函数定义相同

```<?php
$closureWithArgs = function ($arg1, $arg2) {
    // body
};

$closureWithArgsAndVars = function ($arg1, $arg2) use ($var1, $var2) {
    // body
};
```
```<?php
$longArgs_noVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) {
    // body
};

$noArgs_longVars = function () use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
    // body
};

$longArgs_longVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
    // body
};

$longArgs_shortVars = function (
    $longArgument,
    $longerArgument,
    $muchLongerArgument
) use ($var1) {
    // body
};

$shortArgs_longVars = function ($arg) use (
    $longVar1,
    $longerVar2,
    $muchLongerVar3
) {
    // body
};
```
```<?php
$foo->bar(
    $arg1,
    function ($arg2) use ($var1) {
        // body
    },
    $arg3
);
```

## \# 修订说明
- 考虑到目前代码风格不一，结合PSRs规范、原来的百姓网编码规范以及现有代码结合考虑，形成了本套编码规范

### \# 文献

- [PHP Standards Recommendations](http://www.php-fig.org/psr/)
- [PHP 代码规范](https://github.com/baixing/Law/wiki/PHP-代码规范)
- [百姓网php编码规范2010-09-16](http://iweb.baixing.com/wiki/index.php/PHP编码规范)